<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Suplementos LATAM - Portal ILAR</title>
    <script src="https://cdn.plot.ly/plotly-2.27.1.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/suplementos-styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="initialLoading" class="initial-loading">
        <div class="loading-logo">
            <i class="fas fa-capsules"></i>
        </div>
        <div class="loading-text">
            Cargando Dashboard de Suplementos LATAM
        </div>
        <div class="loading-progress">
            <div class="loading-bar"></div>
        </div>
        <div class="loading-steps" id="loadingSteps">
            Inicializando sistema...
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <h1>
            <i class="fas fa-capsules"></i>
            Dashboard Suplementos LATAM - Portal ILAR
        </h1>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Filtros Globales -->
        <div class="filters">
            <h2><i class="fas fa-filter"></i> Filtros de Búsqueda</h2>
            
            <div class="filter-row">
                <div class="filter-group">
                    <label for="ingredientSelect">Seleccionar Ingrediente:</label>
                    <select id="ingredientSelect">
                        <option value="all">Todos los ingredientes</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="typeSelect">Tipo de Ingrediente:</label>
                    <select id="typeSelect">
                        <option value="all">Todos los tipos</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Seleccionar Países:</label>
                    <div class="country-multiselect">
                        <div class="selected-countries" id="selectedCountries">
                            <span class="placeholder">Ningún país seleccionado (se mostrarán todos)</span>
                        </div>
                        <div class="country-select-dropdown" id="countryDropdown">
                            <!-- Países se cargan dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="btn btn-primary" onclick="SupplementsDashboard.filters.apply()">
                    <i class="fas fa-search"></i> Aplicar Filtros
                </button>
                <button class="btn btn-secondary" onclick="SupplementsDashboard.filters.clear()">
                    <i class="fas fa-times"></i> Limpiar
                </button>
            </div>
        </div>

        <!-- Estadísticas -->
        <div class="stats" id="statsContainer">
            <div class="stat-card">
                <div class="stat-value" id="totalRecords">-</div>
                <div class="stat-label">Total Registros</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="uniqueCountries">-</div>
                <div class="stat-label">Países Únicos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="uniqueIngredients">-</div>
                <div class="stat-label">Ingredientes Únicos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="establishedPercentage">-</div>
                <div class="stat-label">% Establecido</div>
            </div>
        </div>

        <!-- Dashboard Layout -->
        <div class="dashboard-layout">
            <!-- Sidebar Navigation -->
            <nav class="sidebar">
                <h3><i class="fas fa-bars"></i> Navegación</h3>
                <ul class="sidebar-menu" id="sidebarMenu">
                    <li class="menu-item">
                        <a href="#" class="menu-link active" data-section="datos">
                            <i class="fas fa-table menu-icon"></i>
                            <span class="menu-text">Vista de Datos</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="analisis">
                            <i class="fas fa-chart-bar menu-icon"></i>
                            <span class="menu-text">Análisis Gráfico</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="ingrediente">
                            <i class="fas fa-atom menu-icon"></i>
                            <span class="menu-text">Análisis por Ingrediente</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link" data-section="comparacion">
                            <i class="fas fa-balance-scale menu-icon"></i>
                            <span class="menu-text">Comparación Regulatoria</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Content Area -->
            <main class="content-area">
                <!-- Sección: Vista de Datos -->
                <div id="section-datos" class="content-section active">
                    <h2>📋 Datos de Suplementos</h2>
                
                    <div class="column-selector">
                        <label for="columnSelect">Selecciona columnas a mostrar:</label>
                        <select id="columnSelect" multiple></select>
                        <div class="column-actions">
                            <button class="btn btn-sm" onclick="SupplementsDashboard.table.applyColumns()">Aplicar</button>
                            <button class="btn btn-sm btn-secondary" onclick="SupplementsDashboard.table.resetColumns()">Restablecer</button>
                        </div>
                    </div>
                
                    <div id="dataInfo"></div>
                    <div class="table-container">
                        <table class="data-table" id="dataTable">
                            <thead id="tableHead"></thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>

                    <div class="pagination" id="pagination"></div>
                </div>
                
                <!-- Sección: Análisis Gráfico -->
                <div id="section-analisis" class="content-section">
                    <h2>📊 Análisis Gráfico</h2>
                    <div class="charts-grid">
                        <div class="chart-container">
                            <div id="chart-ingredients-country" class="chart-placeholder">
                                <div class="loading-spinner"></div>
                                <span>Cargando gráfico...</span>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div id="chart-type-distribution" class="chart-placeholder">
                                <div class="loading-spinner"></div>
                                <span>Cargando gráfico...</span>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div id="chart-regulation-status" class="chart-placeholder">
                                <div class="loading-spinner"></div>
                                <span>Cargando gráfico...</span>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div id="chart-top-ingredients" class="chart-placeholder">
                                <div class="loading-spinner"></div>
                                <span>Cargando gráfico...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Análisis por Ingrediente -->
                <div id="section-ingrediente" class="content-section">
                    <h2>🔬 Análisis Detallado por Ingrediente</h2>
                    
                    <div class="ingredient-selector">
                        <label for="ingredientAnalysisSelect">Seleccionar ingrediente:</label>
                        <select id="ingredientAnalysisSelect">
                            <option value="">Selecciona un ingrediente...</option>
                        </select>
                    </div>

                    <div id="ingredientDetails" class="ingredient-details hidden">
                        <div class="ingredient-stats" id="ingredientStats">
                            <div class="stat-card">
                                <div class="stat-value" id="ingredientCountries">-</div>
                                <div class="stat-label">Países con Regulación</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="ingredientType">-</div>
                                <div class="stat-label">Tipo</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="ingredientUnit">-</div>
                                <div class="stat-label">Unidad</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="ingredientRange">-</div>
                                <div class="stat-label">Rango Global</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div id="ingredient-range-chart"></div>
                        </div>

                        <div class="table-container">
                            <table class="data-table" id="ingredientTable">
                                <thead id="ingredientTableHead"></thead>
                                <tbody id="ingredientTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sección: Comparación Regulatoria -->
                <div id="section-comparacion" class="content-section">
                    <h2>🏛️ Comparación de Marco Regulatorio</h2>
                    <p class="section-description">Compara las regulaciones de suplementos entre países de América Latina</p>
                    
                    <div class="comparison-selector">
                        <label for="comparisonCountries">Seleccionar países para comparar:</label>
                        <select id="comparisonCountries" multiple>
                            <option value="Argentina">Argentina</option>
                            <option value="Brasil">Brasil</option>
                            <option value="Chile">Chile</option>
                            <option value="Colombia">Colombia</option>
                            <option value="México">México</option>
                            <option value="Perú">Perú</option>
                        </select>
                        <button class="btn btn-primary" onclick="SupplementsDashboard.comparison.load()">
                            <i class="fas fa-balance-scale"></i> Comparar Regulaciones
                        </button>
                    </div>

                    <div id="comparisonResults" class="comparison-results">
                        <p class="placeholder-text">
                            Selecciona países y haz clic en "Comparar Regulaciones" para ver la comparación.
                        </p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/suplementos-api.js"></script>
    <script src="/static/suplementos-components.js"></script>
    <script src="/static/suplementos-main.js"></script>
    
    <!-- Inicialización -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            SupplementsDashboard.init();
        });
    </script>
</body>
</html>